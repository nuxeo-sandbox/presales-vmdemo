## Description

AWS resources to auto update route 53 records when an EC2 instance is restarted/stopped.

# Installation

The AWS SAM CLI is an extension of the AWS CLI that adds functionality for building and testing Lambda applications. It uses Docker to run your functions in an Amazon Linux environment that matches Lambda. It can also emulate your application's build environment and API.

To use the AWS SAM CLI, you need the following tools:

* AWS CLI - [Install the AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html).
* AWS SAM CLI - [Install the AWS SAM CLI](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html).
* Node.js - [Install Node.js 20](https://nodejs.org/en/), including the npm package management tool.
* Docker - [Install Docker community edition](https://hub.docker.com/search/?type=edition&offering=community).

# Build and deploy

To build and deploy your application, run the following in your shell:

```bash
sam build
```
Then deploy in the target region using the following commands

```bash
rm -rf node_modules
sam deploy --s3-bucket us-east-1-demo-bucket --region us-east-1 --no-confirm-changeset
sam deploy --s3-bucket us-west-1-demo-bucket --region us-west-1 --no-confirm-changeset
sam deploy --s3-bucket us-west-2-demo-bucket --region us-west-2 --no-confirm-changeset
sam deploy --s3-bucket eu-west-1-demo-bucket --region eu-west-1 --no-confirm-changeset
sam deploy --s3-bucket ap-northeast-1-demo-bucket --region ap-northeast-1 --no-confirm-changeset
```

# Dev and unit tests

To run the unit tests
```bash
npm install
npm run test
```

# Local invoke

To invoke locally an instance start event, run the following

```bash
cat << EOF >> ./events/instance-start-event.json
{
  "detail-type": "EC2 Instance State-change Notification",
  "source": "aws.ec2",
  "detail": {
    "instance-id": <instanceID>,
    "state": "running"
  }
}
EOF
sam local invoke -e .\events\instance-start-event.json --region <region> 
```

To invoke locally an instance shutdown event, run the following

```bash
cat << EOF >> ./events/instance-shutdown-event.json
{
  "detail-type": "EC2 Instance State-change Notification",
  "source": "aws.ec2",
  "detail": {
    "instance-id": <instanceID>,
    "state": "shutting-down"
  }
}
EOF
sam local invoke -e .\events\instance-shutdown-event.json --region <region> 
```

## Fetch, tail, and filter Lambda function logs

To simplify troubleshooting, the AWS SAM CLI has a command called `sam logs`. `sam logs` lets you fetch logs that are generated by your Lambda function from the command line. In addition to printing the logs on the terminal, this command has several nifty features to help you quickly find the bug.

```bash
sam logs --region <region> --tail
```

## Cleanup
To delete the application, use the SAM CLI.

```bash
sam delete --region <region>
```

## About Nuxeo
[Nuxeo](www.hyland.com/en/products/nuxeo-platform), developer of the leading Content Services Platform, is reinventing enterprise content management (ECM) and digital asset management (DAM). Nuxeo is fundamentally changing how people work with data and content to realize new value from digital information. Its cloud-native platform has been deployed by large enterprises, mid-sized businesses and government agencies worldwide. Customers like Verizon, Electronic Arts, ABN Amro, and the Department of Defense have used Nuxeo's technology to transform the way they do business. Founded in 2008, the company is based in New York with offices across the United States, Europe, and Asia.

Learn more at www.hyland.com/en/products/nuxeo-platform.
